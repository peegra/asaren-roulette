<!-- ...既存コード... -->
<button id="spin">回す</button>
<audio id="spin-audio" src="spin.mp3"></audio>
<audio id="win-audio" src="win.mp3"></audio>
<!-- ...既存コード... -->
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
const liffId = "YOUR_LIFF_ID"; // ここにLIFF IDを入れる

// LIFF初期化
liff.init({ liffId }).then(() => {
  if (!liff.isLoggedIn()) {
    liff.login({ redirectUri: window.location.href });
  }
});

// ルーレット設定
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const items = ["A","B","C","D","E"];
const colors = ["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF"];
let angle = 0;

// 音声
const spinAudio = document.getElementById('spin-audio');
const winAudio = document.getElementById('win-audio');

// ルーレット描画
function drawRoulette() {
  const arc = (2 * Math.PI) / items.length;
  for (let i = 0; i < items.length; i++) {
    ctx.beginPath();
    ctx.moveTo(150, 150);
    ctx.fillStyle = colors[i];
    ctx.arc(150, 150, 150, angle + i*arc, angle + (i+1)*arc);
    ctx.fill();
    
    // 文字
    ctx.save();
    ctx.translate(150, 150);
    ctx.rotate(angle + (i+0.5)*arc);
    ctx.fillStyle = "#000";
    ctx.textAlign = "right";
    ctx.font = "16px sans-serif";
    ctx.fillText(items[i], 140, 5);
    ctx.restore();
  }
}

// ルーレット回転
let spinning = false;
function spinRoulette() {
  if (spinning) return;
  spinning = true;
  document.getElementById('spin').disabled = true;

  // 音再生
  spinAudio.currentTime = 0;
  spinAudio.play();

  let rotation = Math.random() * 3 + 3; // 回転量を短く
  const step = 0.15; // 速く回す
  const interval = setInterval(() => {
    angle += step;
    rotation -= step;
    ctx.clearRect(0, 0, 300, 300);
    drawRoulette();
    if(rotation <= 0) {
      clearInterval(interval);
      spinAudio.pause();
      spinAudio.currentTime = 0;
      winAudio.currentTime = 0;
      winAudio.play();
      spinning = false;
      document.getElementById('spin').disabled = false;
    }
  }, 16); // 60fps
}

// 初期描画
drawRoulette();
document.getElementById('spin').addEventListener('click', spinRoulette);
</script>
<!-- ...既存コード... -->